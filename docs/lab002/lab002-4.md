# Deploy Container Image from the CLI

`oc new-app` is a powerful and commonly used command in the OpenShift CLI. It has the ability to deploy applications from components that include:

* Source or binary code
* Container images
* Templates

The set of objects created by `oc new-app` depends on the artifacts passed as an input.

1. **Run the following command to start an HTTP server (httpd) deployment from a template**:

    ```text
    oc new-app --template=httpd-example
    ```

    ???+ example "Example Output"

        ```text
        user01@lab061:~$ oc new-app --template=httpd-example
        --> Deploying template "openshift/httpd-example" to project user00-project

            Apache HTTP Server
            ---------
            An example Apache HTTP Server (httpd) application that serves static content. For more information about using this template, including OpenShift considerations, see https://github.com/sclorg/httpd-ex/blob/master/README.md.

            The following service(s) have been created in your project: httpd-example.

            For more information about using this template, including OpenShift considerations, see https://github.com/sclorg/httpd-ex/blob/master/README.md.

            * With parameters:
                * Name=httpd-example
                * Namespace=openshift
                * Memory Limit=512Mi
                * Git Repository URL=https://github.com/sclorg/httpd-ex.git
                * Git Reference=
                * Context Directory=
                * Application Hostname=
                * GitHub Webhook Secret=RWOich7rQxeyDc5X4R8AWHivcTHdOhTjCUWDLFe1 # generated
                * Generic Webhook Secret=4lAUcEAQJu2cCyq2MX0sQ0uIlmsYbAGf5XUM7unN # generated

        --> Creating resources ...
            service "httpd-example" created
            route.route.openshift.io "httpd-example" created
            imagestream.image.openshift.io "httpd-example" created
            buildconfig.build.openshift.io "httpd-example" created
            deploymentconfig.apps.openshift.io "httpd-example" created
        --> Success
            Access your application via route 'httpd-example-user00-project.apps.atsocppa.dmz'
            Build scheduled, use 'oc logs -f buildconfig/httpd-example' to track its progress.
            Run 'oc status' to view your app.        ```
    ???+ Note
        Notice a few things:

        * OpenShift went out and found a template that matches your desired deployment – httpd-example.

        * You’re told what exactly is going to be created and what it will be named.

        * Those objects are then created within your project space.

        * You’re told that the application was successfully deployed and also exposed via a *route*. This mean that it is accessible from outside the cluster.

2. **Run the following command** to view the app in your project space:

    ```text
    oc status
    ```

    ???+ example "Example Output"
        ```text
        user01@lab061:~$ oc status
        In project user00-project on server https://api.atsocppa.dmz:6443

        http://httpd-example-user00-project.apps.atsocppa.dmz (svc/httpd-example)
        dc/httpd-example deploys istag/httpd-example:latest <-
            bc/httpd-example source builds https://github.com/sclorg/httpd-ex.git on openshift/httpd:2.4-el8
            deployment #1 deployed about a minute ago - 1 pod

        View details with 'oc describe <resource>/<name>' or list resources with 'oc get all'.
        ```
3. Now **run the following command** to see all of the objects that were built:

    ```text
    oc get all
    ```

    ???+ example "Example Output"

        ```text
        user01@lab061:~$ oc get all
        NAME                         READY   STATUS      RESTARTS   AGE
        pod/httpd-example-1-build    0/1     Completed   0          2m41s
        pod/httpd-example-1-deploy   0/1     Completed   0          2m7s
        pod/httpd-example-1-pgxxp    1/1     Running     0          2m3s

        NAME                                    DESIRED   CURRENT   READY   AGE
        replicationcontroller/httpd-example-1   1         1         1       2m7s

        NAME                    TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)    AGE
        service/httpd-example   ClusterIP   172.30.232.138   <none>        8080/TCP   2m42s

        NAME                                               REVISION   DESIRED   CURRENT   TRIGGERED BY
        deploymentconfig.apps.openshift.io/httpd-example   1          1         1         config,image(httpd-example:latest)

        NAME                                           TYPE     FROM   LATEST
        buildconfig.build.openshift.io/httpd-example   Source   Git    1

        NAME                                       TYPE     FROM          STATUS     STARTED         DURATION
        build.build.openshift.io/httpd-example-1   Source   Git@744d904   Complete   2 minutes ago   38s

        NAME                                           IMAGE REPOSITORY                                                                        TAGS     UPDATED
        imagestream.image.openshift.io/httpd-example   default-route-openshift-image-registry.apps.atsocppa.dmz/user00-project/httpd-example   latest   2 minutes ago

        NAME                                     HOST/PORT                                        PATH   SERVICES        PORT    TERMINATION   WILDCARD
        route.route.openshift.io/httpd-example   httpd-example-user00-project.apps.atsocppa.dmz          httpd-example   <all>                 None
        ```

    These are the objects that OpenShift told us would be created, and they all work together to run the application. While they’re all important pieces of this puzzle, *pods* are where the application code is actually running. Let’s narrow down on our pods.

    ???+ Note
        You might also have objects left over from other labs if they were not completely cleaned out. This is okay and the objects for different applications will not interfere with one another due to their use of *labels*.

4. **Run the command**:

    ```text
    oc get pods
    ```

    ???+ example "Example Output"

        ```text
        user01@lab061:~$ oc get pods
        NAME             READY   STATUS      RESTARTS   AGE
        httpd-example-1-build    0/1     Completed   0          3m12s
        httpd-example-1-deploy   0/1     Completed   0          2m38s
        httpd-example-1-r8dpw    1/1     Running     0          2m34s        
        ```

    The `oc new-app` command created three pods. One ending with `build`, one ending with `deploy` and the other ending with a randomly-generated string of 5 characters (`r8dpw` in the screenshot above). They are all associated with your httpd deployment, but two are in a *Completed* status, and one is *Running*. The *Completed* pods had one simple job each – build the application pod, and deploy the application pod. The `Running` pod is the running httpd server, and that's what we're interested in.

1. **Run the following command** to see the logs for the build pod:

    ```text
    oc logs pod/httpd-example-1-build
    ```

    ??? "Expand to see Example Output"

        ```text
        time="2022-09-07T15:06:46Z" level=info msg="Not using native diff for overlay, this may cause degraded performance for building images: kernel has CONFIG_OVERLAY_FS_REDIRECT_DIR enabled"
        I0907 15:06:46.532335       1 defaults.go:102] Defaulting to storage driver "overlay" with options [mountopt=metacopy=on].
        Caching blobs under "/var/cache/blobs".
        Trying to pull image-registry.openshift-image-registry.svc:5000/openshift/httpd@sha256:2b81d44b025f1ec399b0af0f4b9f1f315ecccd86db739d33e49a24138d831669...
        Getting image source signatures
        Copying blob sha256:f305bb7e80751f62007e416634d5fbdde5a09dfbeec8ead01c4a030521406fd1
        Copying blob sha256:8c8566bb888e9a3890647fe37bcd0794a98256331552368fb2e120c3a71769ba
        Copying blob sha256:b8a244553a3955b277a7f2af3459c46bc4504302e707c95233a0ce97e90fe066
        Copying blob sha256:5050a44fec5224351630e11142efe5b28eb680db5080aa01459d643b38af870f
        Copying config sha256:646dbe8bd260d5e2d2f6cb488f38fa4bb569efe09f25dd926e6dbe6e7c1c02e2
        Writing manifest to image destination
        Storing signatures
        Generating dockerfile with builder image image-registry.openshift-image-registry.svc:5000/openshift/httpd@sha256:2b81d44b025f1ec399b0af0f4b9f1f315ecccd86db739d33e49a24138d831669
        Adding transient rw bind mount for /run/secrets/rhsm
        STEP 1/9: FROM image-registry.openshift-image-registry.svc:5000/openshift/httpd@sha256:2b81d44b025f1ec399b0af0f4b9f1f315ecccd86db739d33e49a24138d831669
        STEP 2/9: LABEL "io.openshift.build.commit.date"="Tue Jul 19 16:22:14 2022 +0200"       "io.openshift.build.commit.id"="744d904524011619b3a8a16cb5e535fed6233998"       "io.openshift.build.commit.ref"="master"       "io.openshift.build.commit.message"="Merge pull request #36 from sclorg/issue_35"       "io.openshift.build.source-location"="https://github.com/sclorg/httpd-ex.git"       "io.openshift.build.image"="image-registry.openshift-image-registry.svc:5000/openshift/httpd@sha256:2b81d44b025f1ec399b0af0f4b9f1f315ecccd86db739d33e49a24138d831669"       "io.openshift.build.commit.author"="Petr Hracek <phracek@redhat.com>"
        STEP 3/9: ENV OPENSHIFT_BUILD_NAME="httpd-example-1"     OPENSHIFT_BUILD_NAMESPACE="user00-project"     OPENSHIFT_BUILD_SOURCE="https://github.com/sclorg/httpd-ex.git"     OPENSHIFT_BUILD_COMMIT="744d904524011619b3a8a16cb5e535fed6233998"
        STEP 4/9: USER root
        STEP 5/9: COPY upload/src /tmp/src
        STEP 6/9: RUN chown -R 1001:0 /tmp/src
        STEP 7/9: USER 1001
        STEP 8/9: RUN /usr/libexec/s2i/assemble
        ---> Enabling s2i support in httpd24 image
            AllowOverride All
        ---> Installing application source
        => sourcing 20-copy-config.sh ...
        => sourcing 40-ssl-certs.sh ...
        ---> Generating SSL key pair for httpd...
        STEP 9/9: CMD /usr/libexec/s2i/run
        COMMIT temp.builder.openshift.io/user00-project/httpd-example-1:2fda11d0
        time="2022-09-07T15:07:04Z" level=warning msg="Adding metacopy option, configured globally"
        Getting image source signatures
        Copying blob sha256:92f1e97901b556ffa9ce24be4eface85f849909605cfa3935b03a713480bb8b1
        Copying blob sha256:353a53d37adccad35f2b4aeacca9d81fe75bb082bbc75f2162e31e1f13fd75f3
        Copying blob sha256:d00bac8c7787cb4f8283a257cd267a82e9463330c55123ab1f0f104f109ab93a
        Copying blob sha256:a5ccc3f34f400bdb85cb724ad36a8ace6aaa941b300a2264565f874d494f844e
        Copying blob sha256:d0d25de2e87a45b4e828f6d245dc8f319bcc55755bca88a75ebaba8fa9118c74
        Copying config sha256:b7384dd55cc6c0879aa13de7c5bf4dbd118ea84eb5946ad5849f9874b29cbe3d
        Writing manifest to image destination
        Storing signatures
        --> b7384dd55cc
        Successfully tagged temp.builder.openshift.io/user00-project/httpd-example-1:2fda11d0
        b7384dd55cc6c0879aa13de7c5bf4dbd118ea84eb5946ad5849f9874b29cbe3d

        Pushing image image-registry.openshift-image-registry.svc:5000/user00-project/httpd-example:latest ...
        Getting image source signatures
        Copying blob sha256:d0d25de2e87a45b4e828f6d245dc8f319bcc55755bca88a75ebaba8fa9118c74
        Copying blob sha256:b8a244553a3955b277a7f2af3459c46bc4504302e707c95233a0ce97e90fe066
        Copying blob sha256:8c8566bb888e9a3890647fe37bcd0794a98256331552368fb2e120c3a71769ba
        Copying blob sha256:5050a44fec5224351630e11142efe5b28eb680db5080aa01459d643b38af870f
        Copying blob sha256:f305bb7e80751f62007e416634d5fbdde5a09dfbeec8ead01c4a030521406fd1
        Copying config sha256:b7384dd55cc6c0879aa13de7c5bf4dbd118ea84eb5946ad5849f9874b29cbe3d
        Writing manifest to image destination
        Storing signatures
        Successfully pushed image-registry.openshift-image-registry.svc:5000/user00-project/httpd-example@sha256:bd19230bffb03932d7fcf2ead029d18347bbc13aecea376bf718a3c53bd7d364
        Push successful
        ```

    The build pod log lets you see all of the steps that were taken to containerize the httpd source code. If you are familiar with containerization, you will notice that each step is the output from a line in a Dockerfile/Containerfile. You could have built this image yourself and then deployed it to OpenShift, but why not let OpenShift do the heavy working for us?

2. **Run the following command** to see the logs for the httpd server pod:

    ```text
    oc logs pod/httpd-example-1-XXXXX
    ```

    Where `XXXXX` is your unique string of characters that you saw in the `oc get pods` output.

    ???+ example "Example Output"

        ```text
        => sourcing 10-set-mpm.sh ...
        => sourcing 20-copy-config.sh ...
        => sourcing 40-ssl-certs.sh ...
        AH00558: httpd: Could not reliably determine the server's fully qualified domain name, using 10.128.2.72. Set the 'ServerName' directive globally to suppress this message
        [Wed Sep 07 15:07:23.012881 2022] [ssl:warn] [pid 1:tid 4396165818656] AH01909: 10.128.2.72:8443:0 server certificate does NOT include an ID which matches the server name
        [Wed Sep 07 15:07:23.013141 2022] [:notice] [pid 1:tid 4396165818656] ModSecurity for Apache/2.9.2 (http://www.modsecurity.org/) configured.
        [Wed Sep 07 15:07:23.013147 2022] [:notice] [pid 1:tid 4396165818656] ModSecurity: APR compiled version="1.6.3"; loaded version="1.6.3"
        [Wed Sep 07 15:07:23.013150 2022] [:notice] [pid 1:tid 4396165818656] ModSecurity: PCRE compiled version="8.42 "; loaded version="8.42 2018-03-20"
        [Wed Sep 07 15:07:23.013156 2022] [:notice] [pid 1:tid 4396165818656] ModSecurity: LUA compiled version="Lua 5.3"
        [Wed Sep 07 15:07:23.013160 2022] [:notice] [pid 1:tid 4396165818656] ModSecurity: YAJL compiled version="2.1.0"
        [Wed Sep 07 15:07:23.013163 2022] [:notice] [pid 1:tid 4396165818656] ModSecurity: LIBXML compiled version="2.9.7"
        [Wed Sep 07 15:07:23.013172 2022] [:notice] [pid 1:tid 4396165818656] ModSecurity: Status engine is currently disabled, enable it by set SecStatusEngine to On.
        [Wed Sep 07 15:07:23.118901 2022] [ssl:warn] [pid 1:tid 4396165818656] AH01909: 10.128.2.72:8443:0 server certificate does NOT include an ID which matches the server name
        [Wed Sep 07 15:07:23.119089 2022] [lbmethod_heartbeat:notice] [pid 1:tid 4396165818656] AH02282: No slotmem from mod_heartmonitor
        [Wed Sep 07 15:07:23.124907 2022] [mpm_event:notice] [pid 1:tid 4396165818656] AH00489: Apache/2.4.37 (Red Hat Enterprise Linux) OpenSSL/1.1.1g configured -- resuming normal operations
        [Wed Sep 07 15:07:23.124925 2022] [core:notice] [pid 1:tid 4396165818656] AH00094: Command line: 'httpd -D FOREGROUND'
        10.128.2.1 - - [07/Sep/2022:15:07:25 +0000] "GET / HTTP/1.1" 200 37451 "-" "kube-probe/1.23"
        10.128.2.1 - - [07/Sep/2022:15:07:34 +0000] "GET / HTTP/1.1" 200 37451 "-" "kube-probe/1.23"
        ```

In the next section, you will navigate to the exposed route to see the application that you just deployed.
